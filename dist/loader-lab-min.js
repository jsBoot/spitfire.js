/*
 <a href="http://en.wikipedia.org/wiki/MIT_License">MIT</a>.
 @copyright All rights reserved <a href="http://www.webitup.fr">copyright WebItUp <dev@webitup.fr> (http://www.webitup.fr/lab)</a>
 @name loader.js
 @location https://github.com/jsBoot/spitfire.js/blob/master/src/loader.js#111-0f8cc49a5082f7c6a0ca6ae84a9d585ad117fcd2
*/
'use strict';(function(p){function n(g,b){var a=/^\w+\:\/\//;/^\/\/\/?/.test(g)?g=location.protocol+g:a.test(g)||"/"==g.charAt(0)||(g=(b||"")+g);return a.test(g)?g:("/"==g.charAt(0)?A:w)+g}function s(g,b){for(var a in g)g.hasOwnProperty(a)&&(b[a]=g[a]);return b}function r(a,b,c,e){a.onload=a.onreadystatechange=function(){a.readyState&&"complete"!=a.readyState&&"loaded"!=a.readyState||b[c]||(a.onload=a.onreadystatechange=null,e())}}function u(a){a.ready=a.finished=!0;for(var b=0;b<a.finished_listeners.length;b++)a.finished_listeners[b]();
a.ready_listeners=[];a.finished_listeners=[]}function z(a,b,e,l,k){setTimeout(function(){var d,f=b.real_src,m;if("item"in q){if(!q[0]){setTimeout(arguments.callee,25);return}q=q[0]}d=document.createElement("script");b.type&&(d.type=b.type);b.charset&&(d.charset=b.charset);k?x?(e.elem=d,B?(d.preload=!0,d.onpreload=l):d.onreadystatechange=function(){"loaded"==d.readyState&&l()},d.src=f):k&&0==f.indexOf(A)&&a[c]?(m=new XMLHttpRequest,m.onreadystatechange=function(){4==m.readyState&&(m.onreadystatechange=
function(){},e.text=m.responseText+"\n//@ sourceURL="+f,l())},m.open("GET",f),m.send()):(d.type="text/cache-script",r(d,e,"ready",function(){q.removeChild(d);l()}),d.src=f,q.insertBefore(d,q.firstChild)):(C&&(d.async=!1),r(d,e,"finished",l),d.src=f,q.insertBefore(d,q.firstChild))},0)}function b(){function g(a,b,c){function e(){null!=h&&(h=null,u(c))}var h;v[b.src].finished||(a[k]||(v[b.src].finished=!0),h=c.elem||document.createElement("script"),b.type&&(h.type=b.type),b.charset&&(h.charset=b.charset),
r(h,c,"finished",e),c.elem?c.elem=null:c.text?(h.onload=h.onreadystatechange=null,h.text=c.text):h.src=b.real_src,q.insertBefore(h,q.firstChild),c.text&&e())}function w(b,a,c,e){var h,d,m=function(){a.ready_cb(a,function(){g(b,a,h)})},l=function(){a.finished_cb(a,c)};a.src=n(a.src,b[D]);a.real_src=a.src+(b[f]?(/\?.*$/.test(a.src)?"&_":"?_")+~~(1E9*Math.random())+"=":"");v[a.src]||(v[a.src]={items:[],finished:!1});d=v[a.src].items;b[k]||0==d.length?(h=d[d.length]={ready:!1,finished:!1,ready_listeners:[m],
finished_listeners:[l]},z(b,a,h,e?function(){h.ready=!0;for(var a=0;a<h.ready_listeners.length;a++)h.ready_listeners[a]();h.ready_listeners=[]}:function(){u(h)},e)):(h=d[0],h.finished?l():h.finished_listeners.push(l))}function y(){function a(b,d){b.ready=!0;b.exec_trigger=d;c()}function b(a,d){a.ready=a.finished=!0;a.exec_trigger=null;for(var e=0;e<d.scripts.length;e++)if(!d.scripts[e].finished)return;d.finished=!0;c()}function c(){for(;f<g.length;)if("[object Function]"==Object.prototype.toString.call(g[f]))try{g[f++]()}catch(a){}else{if(!g[f].finished){for(var b=
g[f],d=!1,e=0;e<b.scripts.length;e++)b.scripts[e].ready&&b.scripts[e].exec_trigger&&(d=!0,b.scripts[e].exec_trigger(),b.scripts[e].exec_trigger=null);if(d)continue;break}f++}f==g.length&&(k=m=!1)}var d,h=s(l,{}),g=[],f=0,m=!1,k;d={script:function(){for(var c=0;c<arguments.length;c++){var f=arguments[c],l=arguments[c],p=void 0;"[object Array]"==Object.prototype.toString.call(f)||(l=[f]);for(var n=0;n<l.length;n++)k&&k.scripts||g.push(k={scripts:[],finished:!0}),f=l[n],"[object Function]"==Object.prototype.toString.call(f)&&
(f=f()),f&&("[object Array]"==Object.prototype.toString.call(f)?(p=[].slice.call(f),p.unshift(n,1),[].splice.apply(l,p),n--):("string"==typeof f&&(f={src:f}),f=s(f,{ready:!1,ready_cb:a,finished:!1,finished_cb:b}),k.finished=!1,k.scripts.push(f),w(h,f,k,t&&m),m=!0,h[e]&&d.wait()))}return d},wait:function(){if(0<arguments.length){for(var a=0;a<arguments.length;a++)g.push(arguments[a]);k=g[g.length-1]}else k=!1;c();return d}};return{script:d.script,wait:d.wait,setOptions:function(a){s(a,h);return d}}}
var l={},t=x||E,d=[],v={},m;l[c]=!0;l[e]=!1;l[k]=!1;l[f]=!1;l[D]="";return m={setGlobalDefaults:function(a){s(a,l);return m},setOptions:function(){return y().setOptions.apply(null,arguments)},script:function(){return y().script.apply(null,arguments)},wait:function(){return y().wait.apply(null,arguments)},queueScript:function(){d[d.length]={type:"script",args:[].slice.call(arguments)};return m},queueWait:function(){d[d.length]={type:"wait",args:[].slice.call(arguments)};return m},runQueue:function(){for(var a=
m,b=d.length,c;0<=--b;)c=d.shift(),a=a[c.type].apply(null,c.args);return a},noConflict:function(){p.$LAB=a;return m},sandbox:function(){return b()}}}var a=p.$LAB,c="UseLocalXHR",e="AlwaysPreserveOrder",k="AllowDuplicates",f="CacheBust",D="BasePath",w=/^[^?#]*\//.exec(location.href)[0],A=/^\w+\:\/\/\/?[^\/]+/.exec(w)[0],q=document.head||document.getElementsByTagName("head"),F=p.opera&&"[object Opera]"==Object.prototype.toString.call(p.opera)||"MozAppearance"in document.documentElement.style,t=document.createElement("script"),
B="boolean"==typeof t.preload,x=B||t.readyState&&"uninitialized"==t.readyState,C=!x&&!0===t.async,E=!x&&!C&&!F;p.$LAB=b();(function(a,b,c){null==document.readyState&&document[a]&&(document.readyState="loading",document[a](b,c=function(){document.removeEventListener(b,c,!1);document.readyState="complete"},!1))})("addEventListener","DOMContentLoaded")})(this);
(function(){var p;"undefined"!=typeof head&&(p=function(){return function(b,a){b.push(a);return head.js.apply(head.js,b)}});"undefined"!=typeof YUI&&(p=function(){var b;YUI().use("get",function(a){b=a});b.Get.options.async=!0;return function(){b.Get.js.apply(b.Get,arguments)}});"undefined"!=typeof yepnope&&(p=function(){return function(b,a){var c=b[b.length-1];yepnope({load:b,callback:function(b){c==b&&a()}})}});"undefined"!=typeof requirejs&&(p=function(){return function(b,a){requirejs(b,a)}});var n;
"undefined"!=typeof $LAB&&(n=function(){var b=$LAB.sandbox();this.script=function(a){b=b.script(a);return this};this.wait=function(a){b=a?b.wait(a):b.wait();return this}});n||(n=function(){var b=null,a=[],c=!1,e=p(),k=function(){if(!c&&(c=a.shift()))if(c.uris.length)e(c.uris,function(a){var b=c.callback;c=!1;b&&b(a);k()});else{var b=c.callback;c=!1;b&&b();k()}};this.script=function(c){b&&clearTimeout(b);a.length||a.push({uris:[],callback:!1});a[a.length-1].uris.push(c);b=setTimeout(k,1);return this};
this.wait=function(b){var e=a.length?a[a.length-1]:!1;c&&(e=c);if(!e)return b&&b(),this;e.callback?a.push({uris:[],callback:b}):(e.callback=b,a.push({uris:[],callback:!1}));return this}});n.prototype.fork=function(){return new n};n.prototype.base=function(b){var a=document.getElementsByTagName("script"),c;b=RegExp(b);for(var e=0,k;e<a.length;k=a[e].getAttribute("src"),e++)if(k&&b.test(k)){c=k.split("/");c.pop();c=c.join("/")||"./";break}return c||null};var s=1,r=null;n.prototype.style=function(b,
a){var c=document.getElementsByTagName("head")[0],e=document.createElement("link");e.setAttribute("type","text/css");e.setAttribute("rel","stylesheet");e.setAttribute("data-spitfire-index",s);a&&e.setAttribute("media",a);e.setAttribute("href",b);r||(r=c.lastChild);r&&r.nextSibling?c.insertBefore(e,r.nextSibling):c.appendChild(e);r=e;s++};var u="function"===typeof define&&define.amd,z="object"==typeof exports&&exports;u||z?u&&define("Spitfire/loader",new n):("Spitfire"in this||(this.Spitfire={}),this.Spitfire.loader=
new n)}).apply(this);
