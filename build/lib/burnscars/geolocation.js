navigator.geolocation||function(){"use strict";function hasOP(o,p){return Object.prototype.hasOwnProperty.call(o,p)}function PositionError(code,message){this.code=code,this.message=message}function Coordinates(data){this.accuracy=EARTH_RADIUS_M*Math.PI,this.altitude=null,this.altitudeAccuracy=null,this.heading=null,this.latitude=Number(data.latitude),this.longitude=Number(data.longitude),this.speed=null}function Geoposition(data){this.timestamp=Number(new Date),this.coords=new Coordinates(data)}function GeolocationPolyfill(){function dispatch(handler,data){"function"==typeof handler?setTimeout(function(){handler(data)},0):"object"==typeof handler&&handler&&"handleEvent"in handler&&(handler=handler.handleEvent,setTimeout(function(){handler(data)},0))}function acquireLocation(onSuccess){function cleanup(){script.parentNode&&script.parentNode.removeChild(script);try{delete window[cbname]}catch(ex){window[cbname]=void 0}}var script=document.createElement("SCRIPT"),cbname="_geoip_callback_"+Math.floor(Math.random()*(1<<30));return window[cbname]=function(data){cleanup(),onSuccess(new Geoposition(data))},script.onerror=function(){cleanup()},script.src=GEOIP_SERVICE_JSONP+encodeURIComponent(cbname),(document.head||document.body||document.documentElement).appendChild(script),cleanup}var cached=null;this.getCurrentPosition=function(successCallback,errorCallback,options){function onSuccess(position){cached=position,timedOut||(timerId&&clearTimeout(timerId),dispatch(successCallback,position))}function onFailure(){timedOut||(timerId&&clearTimeout(timerId),dispatch(errorCallback,new PositionError(PositionError.POSITION_UNAVAILABLE,"Position unavailable")))}if(!successCallback)throw new TypeError("The successCallback parameter is null.");var maximumAge;maximumAge=options&&hasOP(options,"maximumAge")&&Number(options.maximumAge)>=0?Number(options.maximumAge):0;var timeout;timeout=options&&hasOP(options,"timeout")?Number(options.timeout)>=0?Number(options.timeout):0:1/0;var enableHighAccuracy;if(enableHighAccuracy=options&&hasOP(options,"enableHighAccuracy")?Boolean(enableHighAccuracy):!1,cached&&Number(new Date)-cached.timestamp<maximumAge)return dispatch(successCallback,cached),void 0;if(0===timeout)return dispatch(errorCallback,new PositionError(PositionError.TIMEOUT,"Timed out")),void 0;var timedOut=!1,timerId=0,cancelOperation=acquireLocation(onSuccess,onFailure,enableHighAccuracy);isFinite(timeout)&&(timerId=setTimeout(function(){timedOut=!0,cancelOperation(),dispatch(errorCallback,new PositionError(PositionError.TIMEOUT,"Timed out"))},timeout))};var timers=[],counter=0;this.watchPosition=function(successCallback,errorCallback,options){function acquisitionSteps(){function onSuccess(position){cached=position,timedOut||timerDetails.cleared||(timerId&&(clearTimeout(timerId),timerId=0),Geoposition.distance(lastPosition,position)>=DISTANCE_THRESHOLD_M&&(lastPosition=position,dispatch(successCallback,position)))}function onFailure(){timedOut||timerDetails.cleared||(timerId&&(clearTimeout(timerId),timerId=0),dispatch(errorCallback,new PositionError(PositionError.POSITION_UNAVAILABLE,"Position unavailable")))}var timedOut=!1,cancelOperation=acquireLocation(onSuccess,onFailure,enableHighAccuracy);isFinite(timeout)&&!timerId&&(timerId=setTimeout(function(){timedOut=!0,timerId=0,cancelOperation(),timerDetails.cleared||dispatch(errorCallback,new PositionError(PositionError.TIMEOUT,"Timed out"))},timeout))}function systemEvent(){acquisitionSteps()}if(!successCallback)throw new TypeError("The successCallback parameter is null.");var maximumAge;maximumAge=options&&hasOP(options,"maximumAge")&&Number(options.maximumAge)>=0?Number(options.maximumAge):0;var timeout;timeout=options&&hasOP(options,"timeout")?Number(options.timeout)>=0?Number(options.timeout):0:1/0;var enableHighAccuracy;enableHighAccuracy=options&&hasOP(options,"enableHighAccuracy")?Boolean(enableHighAccuracy):!1,cached&&Number(new Date)-cached.timestamp<maximumAge&&dispatch(successCallback,cached);var lastPosition=null,timerId=0;acquisitionSteps();var intervalId=setInterval(systemEvent,POLL_TIMER_MS),timerDetails={intervalId:intervalId,cleared:!1},watchId=++counter;return timers[watchId]=timerDetails,watchId},this.clearWatch=function(watchId){if(watchId=Number(watchId),hasOP(timers,watchId)){var timerDetails=timers[watchId];delete timers[watchId],clearInterval(timerDetails.intervalId),timerDetails.cleared=!0}}}var GEOIP_SERVICE_JSONP="http://freegeoip.net/json/google.com?callback=",SERVICE_THROTTLE_QPS=1e3/3600,POLITENESS_FACTOR=2,POLL_TIMER_MS=1e3/SERVICE_THROTTLE_QPS*POLITENESS_FACTOR,DISTANCE_THRESHOLD_M=20,EARTH_RADIUS_M=6384e3;PositionError.PERMISSION_DENIED=1,PositionError.POSITION_UNAVAILABLE=2,PositionError.TIMEOUT=3,PositionError.prototype=new Error,Geoposition.distance=function(p1,p2){function angle(b1,l1,b2,l2){function d2r(d){return d*Math.PI/180}var p1=Math.cos(d2r(l1-l2)),p2=Math.cos(d2r(b1-b2)),p3=Math.cos(d2r(b1+b2));return Math.acos((p1*(p2+p3)+(p2-p3))/2)}return p1===p2?0:p1&&p2?EARTH_RADIUS_M*angle(p1.coords.latitude,p1.coords.longitude,p2.coords.latitude,p2.coords.longitude):1/0},navigator.geolocation||(navigator.geolocation=new GeolocationPolyfill,window.PositionError=PositionError)}();
//# sourceMappingURL=geolocation.js.map