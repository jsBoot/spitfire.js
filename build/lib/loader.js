(function(){"use strict";var backend;"undefined"!=typeof head&&(backend=function(){return function(uris,callback){return uris.push(callback),head.js.apply(head.js,uris)}}),"undefined"!=typeof YUI&&(backend=function(){var Y;return YUI().use("get",function(o){Y=o,Y.Get.options.async=!0}),function(){Y.Get.js.apply(Y.Get,arguments)}}),"undefined"!=typeof yepnope&&(backend=function(){return function(uris,callback){var stamp=uris[uris.length-1];yepnope({load:uris,callback:function(url){stamp==url&&callback()}})}}),"undefined"!=typeof requirejs&&(backend=function(){return function(uris,callback){requirejs(uris,callback)}});var PvLoader;"undefined"!=typeof $LAB&&(PvLoader=function(){var q=$LAB.sandbox();this.script=function(uri){return q=q.script(uri),this},this.wait=function(cbk){return q=cbk?q.wait(cbk):q.wait(),this}}),PvLoader||(PvLoader=function(){var linger=null,toLoad=[],currentLoading=!1,bck=backend(),lingerEnd=function(){if(!currentLoading&&(currentLoading=toLoad.shift())){if(!currentLoading.uris.length){var cl=currentLoading.callback;return currentLoading=!1,cl&&cl(),lingerEnd(),void 0}bck(currentLoading.uris,function(err){var cl=currentLoading.callback;currentLoading=!1,cl&&cl(err),lingerEnd()})}};this.script=function(uri){return linger&&clearTimeout(linger),toLoad.length||toLoad.push({uris:[],callback:!1}),toLoad[toLoad.length-1].uris.push(uri),linger=setTimeout(lingerEnd,1),this},this.wait=function(callback){var me=toLoad.length?toLoad[toLoad.length-1]:!1;return currentLoading&&(me=currentLoading),me?(me.callback?toLoad.push({uris:[],callback:callback}):(me.callback=callback,toLoad.push({uris:[],callback:!1})),this):(callback&&callback(),this)}}),PvLoader.prototype.fork=function(){return new PvLoader},PvLoader.prototype.base=function(pattern){for(var m,it,c=document.getElementsByTagName("script"),re=new RegExp(pattern),x=0;x<c.length;it=c[x].getAttribute("src"),x++)if(it&&re.test(it)){m=it.split("/"),m.pop(),m=m.join("/")||"./";break}return m||null};var idx=1,hook=null;PvLoader.prototype.style=function(url,media){var h=document.getElementsByTagName("head")[0],s=document.createElement("link");s.setAttribute("type","text/css"),s.setAttribute("rel","stylesheet"),s.setAttribute("data-spitfire-index",idx),media&&s.setAttribute("media",media),s.setAttribute("href",url),hook||(hook=h.lastChild),hook&&hook.nextSibling?h.insertBefore(s,hook.nextSibling):h.appendChild(s),hook=s,idx++};var isLoader="function"==typeof define&&define.amd,root="object"==typeof exports&&exports;isLoader||root?isLoader&&define("Spitfire/loader",new PvLoader):("Spitfire"in this||(this.Spitfire={}),this.Spitfire.loader=new PvLoader)}).apply(this);
//# sourceMappingURL=loader.js.map